services:
  - type: web
    name: expo-coupon
    env: node
    plan: free
    buildCommand: |
      cd frontend && npm install && npm run build &&
      cd ../backend && npm install &&
      cp -r ../frontend/dist ./public
    startCommand: cd backend && node server.production.js
    envVars:
      - key: JWT_SECRET
        generateValue: true
      - key: NODE_ENV
        value: production
      - key: TWILIO_ACCOUNT_SID
        sync: false
      - key: TWILIO_AUTH_TOKEN
        sync: false
      - key: TWILIO_WHATSAPP_NUMBER
        value: "+14155238886"
      - key: BRANCHES
        value: "Calicut,Kochi,Thrissur,Kannur,Malappuram"
    disk:
      name: coupon-data
      mountPath: /var/data
      sizeGB: 1
    healthCheckPath: /api/health
